<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermostat Widget Test Bed</title>
    <style>
        /* ==================== COLOR THEME CONFIGURATION ==================== */
        :root {
            /* Primary Theme Colors */
            --page-background: #0f172a;        /* Very dark slate for main background */
            --widget-area-bg: #1e293b;         /* Dark slate blue for widget container */
            --panel-background: #1e293b;       /* Panel background */
            --panel-border: #334155;           /* Panel borders */
            --control-group-bg: #334155;       /* Control group backgrounds */
            
            /* Thermostat Widget Colors */
            --dial-background-1: #334155;      /* Dial outer gradient start */
            --dial-background-2: #1e293b;      /* Dial outer gradient end */
            --dial-inner-1: #374151;           /* Inner dial gradient start */
            --dial-inner-2: #1f2937;           /* Inner dial gradient middle */
            --dial-inner-3: #111827;           /* Inner dial gradient end */
            
            /* Active/Accent Colors */
            --accent-primary: #06b6d4;         /* Bright cyan for active elements */
            --accent-glow: rgba(6, 182, 212, 0.4); /* Cyan glow effect */
            --accent-secondary: #0891b2;       /* Slightly darker cyan for interactions */
            
            /* Text Colors */
            --text-primary: #f1f5f9;           /* Primary text (temperature) */
            --text-secondary: #94a3b8;         /* Secondary text (labels) */
            --text-muted: #64748b;             /* Muted text (status) */
            --text-panel-header: #e2e8f0;      /* Panel headers */
            
            /* Inactive Elements */
            --tick-inactive: #475569;          /* Inactive tick marks */
            --range-labels: #64748b;           /* Min/max labels */
            
            /* Buttons */
            --button-background-1: #334155;    /* Button gradient start */
            --button-background-2: #1e293b;    /* Button gradient end */
            --button-hover-1: #475569;         /* Button hover gradient start */
            --button-hover-2: #334155;         /* Button hover gradient end */
            --button-text: #94a3b8;            /* Button text */
            --button-text-hover: #e2e8f0;      /* Button text on hover */
            
            /* Debug Panel Specific */
            --input-background: #374151;       /* Input field backgrounds */
            --input-border: #4b5563;           /* Input field borders */
            --input-text: #e5e7eb;             /* Input text color */
            --log-background: #111827;         /* Log area background */
            --log-text: #9ca3af;               /* Log text color */
            --log-input: #06b6d4;              /* Log input message color */
            --log-output: #10b981;             /* Log output message color */
            --log-error: #ef4444;              /* Log error message color */
            
            /* Shadows and Effects */
            --shadow-primary: rgba(0, 0, 0, 0.4);
            --shadow-inset-light: rgba(255, 255, 255, 0.05);
            --shadow-inset-dark: rgba(0, 0, 0, 0.4);
        }
        /* ===================================================================== */

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--page-background);
            color: var(--text-primary);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
        }

        .widget-area {
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--widget-area-bg);
            border-radius: 12px;
            padding: 40px;
            min-height: 400px;
            border: 1px solid var(--panel-border);
        }

        .debug-panel {
            background: var(--panel-background);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--panel-border);
        }

        .debug-panel h2 {
            margin-bottom: 20px;
            color: var(--text-panel-header);
            font-size: 18px;
        }

        .control-group {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--control-group-bg);
            border-radius: 8px;
            border: 1px solid var(--panel-border);
        }

        .control-group h3 {
            margin-bottom: 10px;
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            gap: 10px;
        }

        .input-row:last-child {
            margin-bottom: 0;
        }

        label {
            min-width: 120px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        input[type="number"], input[type="range"] {
            flex: 1;
            padding: 6px 10px;
            background: var(--input-background);
            border: 1px solid var(--input-border);
            border-radius: 4px;
            color: var(--input-text);
            font-size: 13px;
        }

        input[type="range"] {
            padding: 0;
            height: 20px;
        }

        .range-value {
            min-width: 40px;
            text-align: center;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .btn {
            padding: 8px 16px;
            background: var(--accent-primary);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .btn:hover {
            background: var(--accent-secondary);
        }

        .btn.secondary {
            background: var(--button-background-1);
            color: var(--button-text);
        }

        .btn.secondary:hover {
            background: var(--button-hover-1);
            color: var(--button-text-hover);
        }

        .log-area {
            background: var(--log-background);
            border: 1px solid var(--input-border);
            border-radius: 4px;
            padding: 10px;
            height: 120px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: var(--log-text);
            margin-top: 10px;
        }

        .log-entry {
            margin-bottom: 2px;
            word-break: break-all;
        }

        .log-entry.input {
            color: var(--log-input);
        }

        .log-entry.output {
            color: var(--log-output);
        }

        .log-entry.error {
            color: var(--log-error);
        }

        .presets {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--tick-inactive);
            margin-right: 8px;
        }

        .status-indicator.active {
            background: var(--accent-primary);
            box-shadow: 0 0 6px var(--accent-glow);
        }

        /* Thermostat Widget Styles (copied from thermostat2.html) */
        .thermostat {
            position: relative;
            width: 280px;
            height: 280px;
        }

        .dial {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(145deg, var(--dial-background-1), var(--dial-background-2));
            box-shadow: 
                0 8px 30px var(--shadow-primary),
                inset 0 2px 4px var(--shadow-inset-light);
        }

        .dial-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 75%;
            height: 75%;
            border-radius: 50%;
            background: linear-gradient(165deg, var(--dial-inner-1) 0%, var(--dial-inner-2) 50%, var(--dial-inner-3) 100%);
            box-shadow: 
                inset 0 4px 12px var(--shadow-inset-dark),
                inset 0 -2px 6px var(--shadow-inset-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .ticks {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .tick {
            position: absolute;
            top: 8px;
            left: 50%;
            width: 2px;
            height: 10px;
            background: var(--tick-inactive);
            border-radius: 1px;
            transform-origin: 50% 132px;
        }

        .tick.active {
            background: var(--accent-primary);
            box-shadow: 0 0 4px var(--accent-glow);
        }

        .indicator {
            position: absolute;
            top: 8px;
            left: 50%;
            width: 2px;
            height: 10px;
            background: transparent;
            transform-origin: 50% 132px;
            z-index: 15;
            transition: transform 0.3s ease;
        }
        
        .indicator::after {
            content: '';
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 10px solid var(--accent-primary);
            filter: drop-shadow(0 0 4px var(--accent-glow));
        }

        .dial-content {
            text-align: center;
            color: var(--text-primary);
            z-index: 15;
        }

        .dial-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }

        .dial-temperature {
            font-size: 52px;
            font-weight: 300;
            line-height: 1;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .dial-temperature .degree {
            font-size: 28px;
            vertical-align: super;
        }

        .dial-status {
            font-size: 12px;
            color: var(--text-muted);
            min-height: 14px;
        }

        .range-label {
            position: absolute;
            font-size: 13px;
            color: var(--range-labels);
        }

        .range-label.min {
            bottom: 28px;
            left: 65px;
        }

        .range-label.max {
            bottom: 28px;
            right: 65px;
        }

        .controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 20;
        }

        .thermostat .btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(145deg, var(--button-background-1), var(--button-background-2));
            box-shadow: 
                0 3px 8px var(--shadow-primary),
                inset 0 1px 2px var(--shadow-inset-light);
            color: var(--button-text);
            font-size: 24px;
            font-weight: 300;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            user-select: none;
            margin: 0;
        }

        .thermostat .btn:hover {
            background: linear-gradient(145deg, var(--button-hover-1), var(--button-hover-2));
            color: var(--button-text-hover);
        }

        .thermostat .btn:active {
            transform: scale(0.95);
            box-shadow: 
                0 2px 4px var(--shadow-primary),
                inset 0 1px 2px var(--shadow-inset-light);
        }

        .thermostat .btn span {
            line-height: 1;
            margin-top: -2px;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .debug-panel {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="widget-area">
            <div class="thermostat">
                <div class="dial">
                    <!-- Tick marks -->
                    <div class="ticks" id="ticks"></div>
                    
                    <!-- Arrow indicator -->
                    <div class="indicator" id="indicator"></div>

                    <!-- Inner dial with content -->
                    <div class="dial-inner">
                        <div class="dial-content">
                            <div class="dial-label" id="dialLabel">Current 21.8°</div>
                            <div class="dial-temperature">
                                <span id="tempValue">22.5</span><span class="degree">°</span>
                            </div>
                            <div class="dial-status" id="dialStatus">Heating 65%</div>
                        </div>
                    </div>

                    <!-- Min/Max labels -->
                    <span class="range-label min" id="minLabel">15°</span>
                    <span class="range-label max" id="maxLabel">30°</span>

                    <!-- Control buttons -->
                    <div class="controls">
                        <button class="btn" id="btnMinus" aria-label="Decrease temperature">
                            <span>−</span>
                        </button>
                        <button class="btn" id="btnPlus" aria-label="Increase temperature">
                            <span>+</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="debug-panel">
            <h2><span class="status-indicator" id="statusIndicator"></span>Thermostat Test Bed</h2>
            
            <div class="control-group">
                <h3>Input Data</h3>
                
                <div class="input-row">
                    <label>Current Temp:</label>
                    <input type="number" id="inputCurrentTemp" step="0.1" min="-10" max="50" value="21.8">
                    <span>°C</span>
                </div>
                
                <div class="input-row">
                    <label>Target Temp:</label>
                    <input type="number" id="inputTargetTemp" step="0.5" min="5" max="50" value="22.5">
                    <span>°C</span>
                </div>
                
                <div class="input-row">
                    <label>Heating %:</label>
                    <input type="range" id="inputHeatingPercent" min="0" max="100" value="65">
                    <span class="range-value" id="heatingValue">65%</span>
                </div>
                
                <button class="btn" onclick="sendUpdate()">Send Update</button>
                <button class="btn secondary" onclick="sendRandomUpdate()">Random</button>
            </div>

            <div class="control-group">
                <h3>Preset Scenarios</h3>
                <div class="presets">
                    <button class="btn" onclick="loadPreset('cold')">Cold Room</button>
                    <button class="btn" onclick="loadPreset('heating')">Actively Heating</button>
                    <button class="btn" onclick="loadPreset('target_reached')">Target Reached</button>
                    <button class="btn" onclick="loadPreset('overshoot')">Overshoot</button>
                </div>
            </div>

            <div class="control-group">
                <h3>Auto Simulation</h3>
                <button class="btn" id="toggleSimulation" onclick="toggleSimulation()">Start Auto Simulation</button>
                <button class="btn secondary" onclick="clearLog()">Clear Log</button>
            </div>

            <div class="control-group">
                <h3>Activity Log</h3>
                <div class="log-area" id="logArea"></div>
            </div>
        </div>
    </div>

    <script>
        // Widget logic (adapted from thermostat2.html)
        const config = {
            minTemp: 15,
            maxTemp: 30,
            step: 0.5,
            arcStartAngle: 225,
            arcEndAngle: 495,
        };
        
        config.totalTicks = (config.maxTemp - config.minTemp) / config.step;

        // State
        let targetTemp = 22.5;
        let currentTemp = 21.8;
        let heatingPercent = 65;

        // DOM Elements
        const ticksContainer = document.getElementById('ticks');
        const indicator = document.getElementById('indicator');
        const tempValue = document.getElementById('tempValue');
        const dialLabel = document.getElementById('dialLabel');
        const dialStatus = document.getElementById('dialStatus');
        const btnMinus = document.getElementById('btnMinus');
        const btnPlus = document.getElementById('btnPlus');
        const statusIndicator = document.getElementById('statusIndicator');
        const logArea = document.getElementById('logArea');

        // Debug panel elements
        const inputCurrentTemp = document.getElementById('inputCurrentTemp');
        const inputTargetTemp = document.getElementById('inputTargetTemp');
        const inputHeatingPercent = document.getElementById('inputHeatingPercent');
        const heatingValue = document.getElementById('heatingValue');

        // Simulation state
        let simulationInterval = null;

        // Generate tick marks
        function generateTicks() {
            const arcSpan = config.arcEndAngle - config.arcStartAngle;
            
            for (let i = 0; i <= config.totalTicks; i++) {
                const tick = document.createElement('div');
                tick.className = 'tick';
                const angle = config.arcStartAngle + (i / config.totalTicks) * arcSpan;
                tick.style.transform = `translateX(-50%) rotate(${angle}deg)`;
                tick.dataset.index = i;
                ticksContainer.appendChild(tick);
            }
        }

        // Update display
        function updateDisplay() {
            tempValue.textContent = targetTemp.toFixed(1);
            dialLabel.textContent = `Current ${currentTemp.toFixed(1)}°`;
            
            if (heatingPercent > 0) {
                dialStatus.textContent = `Heating ${heatingPercent}%`;
            } else {
                dialStatus.textContent = '';
            }

            const progress = (targetTemp - config.minTemp) / (config.maxTemp - config.minTemp);
            const activeTicks = Math.round(progress * config.totalTicks);
            const ticks = ticksContainer.querySelectorAll('.tick');
            
            ticks.forEach((tick, index) => {
                if (index <= activeTicks) {
                    tick.classList.add('active');
                } else {
                    tick.classList.remove('active');
                }
            });

            const arcSpan = config.arcEndAngle - config.arcStartAngle;
            const indicatorAngle = config.arcStartAngle + (activeTicks / config.totalTicks) * arcSpan;
            indicator.style.transform = `translateX(-50%) rotate(${indicatorAngle}deg)`;

            // Update status indicator
            statusIndicator.classList.toggle('active', heatingPercent > 0);
            
            // Sync debug panel inputs
            inputCurrentTemp.value = currentTemp.toFixed(1);
            inputTargetTemp.value = targetTemp.toFixed(1);
            inputHeatingPercent.value = heatingPercent;
            heatingValue.textContent = heatingPercent + '%';
        }

        // Temperature controls
        function adjustTemp(delta) {
            const newTemp = Math.max(config.minTemp, Math.min(config.maxTemp, targetTemp + delta));
            if (newTemp !== targetTemp) {
                targetTemp = newTemp;
                updateDisplay();
                logMessage('output', `User adjusted target temperature to ${targetTemp.toFixed(1)}°C`);
                
                // Simulate heating response
                setTimeout(() => {
                    const tempDiff = targetTemp - currentTemp;
                    if (tempDiff > 0.2) {
                        heatingPercent = Math.min(100, Math.round(tempDiff * 50 + Math.random() * 20));
                    } else {
                        heatingPercent = 0;
                    }
                    updateDisplay();
                }, 500);
            }
        }

        // Update from external data
        function updateData(data) {
            let changed = false;
            if (data.currentTemp !== undefined && data.currentTemp !== currentTemp) {
                currentTemp = parseFloat(data.currentTemp);
                changed = true;
            }
            if (data.targetTemp !== undefined && data.targetTemp !== targetTemp) {
                targetTemp = parseFloat(data.targetTemp);
                changed = true;
            }
            if (data.heatingPercent !== undefined && data.heatingPercent !== heatingPercent) {
                heatingPercent = parseInt(data.heatingPercent);
                changed = true;
            }
            
            if (changed) {
                updateDisplay();
                logMessage('input', `Data updated: ${JSON.stringify(data)}`);
            }
        }

        // Debug panel functions
        function sendUpdate() {
            const data = {
                currentTemp: parseFloat(inputCurrentTemp.value),
                targetTemp: parseFloat(inputTargetTemp.value),
                heatingPercent: parseInt(inputHeatingPercent.value)
            };
            updateData(data);
        }

        function sendRandomUpdate() {
            const data = {
                currentTemp: 18 + Math.random() * 8, // 18-26°C
                heatingPercent: Math.random() > 0.3 ? Math.floor(Math.random() * 100) : 0
            };
            updateData(data);
        }

        function loadPreset(preset) {
            const presets = {
                cold: { currentTemp: 18.5, targetTemp: 22.0, heatingPercent: 85 },
                heating: { currentTemp: 20.8, targetTemp: 23.0, heatingPercent: 72 },
                target_reached: { currentTemp: 22.4, targetTemp: 22.5, heatingPercent: 0 },
                overshoot: { currentTemp: 23.2, targetTemp: 22.5, heatingPercent: 0 }
            };
            
            if (presets[preset]) {
                updateData(presets[preset]);
                logMessage('input', `Loaded preset: ${preset}`);
            }
        }

        function toggleSimulation() {
            const button = document.getElementById('toggleSimulation');
            
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
                button.textContent = 'Start Auto Simulation';
                button.classList.remove('secondary');
                logMessage('system', 'Auto simulation stopped');
            } else {
                simulationInterval = setInterval(() => {
                    // Simulate realistic temperature changes
                    const tempDiff = targetTemp - currentTemp;
                    
                    // Room temperature drift
                    if (heatingPercent === 0) {
                        currentTemp += (Math.random() - 0.7) * 0.1; // Slow cooling
                    } else {
                        currentTemp += (tempDiff * 0.1) + (Math.random() - 0.5) * 0.05; // Heating up
                    }
                    
                    currentTemp = Math.max(10, Math.min(35, currentTemp)); // Clamp temperature
                    
                    // Update heating percentage based on temperature difference
                    const newTempDiff = targetTemp - currentTemp;
                    if (Math.abs(newTempDiff) < 0.2) {
                        heatingPercent = 0;
                    } else if (newTempDiff > 0.2) {
                        heatingPercent = Math.min(100, Math.max(10, Math.round(newTempDiff * 50 + Math.random() * 20)));
                    } else {
                        heatingPercent = 0;
                    }
                    
                    updateDisplay();
                }, 2000);
                
                button.textContent = 'Stop Auto Simulation';
                button.classList.add('secondary');
                logMessage('system', 'Auto simulation started');
            }
        }

        function clearLog() {
            logArea.innerHTML = '';
        }

        function logMessage(type, message) {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            logArea.appendChild(entry);
            logArea.scrollTop = logArea.scrollHeight;
            
            // Keep only last 50 entries
            while (logArea.children.length > 50) {
                logArea.removeChild(logArea.firstChild);
            }
        }

        // Update heating value display when slider changes
        inputHeatingPercent.addEventListener('input', function() {
            heatingValue.textContent = this.value + '%';
        });

        // Event listeners for widget controls
        btnMinus.addEventListener('click', () => adjustTemp(-config.step));
        btnPlus.addEventListener('click', () => adjustTemp(config.step));

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp' || e.key === 'ArrowRight') {
                adjustTemp(config.step);
            } else if (e.key === 'ArrowDown' || e.key === 'ArrowLeft') {
                adjustTemp(-config.step);
            }
        });

        // Initialize
        generateTicks();
        updateDisplay();
        logMessage('system', 'Thermostat test bed initialized');

        // Start with a small simulation to show activity
        setTimeout(() => {
            logMessage('system', 'Ready for testing. Use the debug panel to send data updates.');
        }, 500);
    </script>
</body>
</html>